<include file="Public:header" />
<!-- Sidebar begins -->
<script language="javascript" type="text/javascript" src="__JS__/My97DatePicker/WdatePicker.js"></script>
<script src="__JS__/dialog/artDialog.js?skin=default"></script>
<script src="__JS__/zxxFile.js"></script>
<div id="sidebar">
	<include file="Public:left" />
	<!-- Secondary nav -->
</div>
<!-- Sidebar ends -->


<!-- Content begins -->
<div id="content">
    <div class="contentTop">
        <span class="pageTitle">添加4.0版本首页列表脚本配置</span>
       	<div class="clear"></div>
    </div>
    
    <include file="Public:bav" />
    
    <!-- Main content -->
    <div class="wrapper">
        <div class="fluid">
        		<form method='post' id="post_form" name="form1" action="{:U('HomeOnline/doAddScript')}" onsubmit="return false;"  enctype="multipart/form-data">
                    <div class="widget ">
                        <div class="whead">
                        <h6>添加首页【推荐】配置</h6>
                        <a href="{:getCurrentUrl()}" class="buttonH bBlue mb10 mt5">返回</a>
                        <div class="clear"></div></div>
                        <div class="formRow">
                            <div class="grid2"><label>配置名称：<span class="req">*</span> </label></div>
                            <div class="grid3"><input type="text" name="name" value="{$vo.name}" placeholder="配置名称"/></div>
                            <div class="clear"></div>
                        </div>
                        <div class="formRow">
                            <div class="grid2"><label>配置脚本：<span class="req">*</span> </label></div>
                            <div class="grid10">
                            	<label>效果：</label>
                            	<div class="clear" ></div>
                            	<div class="boo-xiaoguo" id="boo_xiaoguo">
                            	<volist name="vo.s" id="script" key="j">
                            		<if condition="$script.type eq 0">
                            			<div class="boo-title boo-item" style="margin-bottom:0px">
											<div style="float:right;" class="js-ctrl">
                								<a class="greenBack js_list_move_up" id="move_up_{$i}">上</a>
                								<a class="greenBack js_list_move_down" id="move_down_{$i}">下</a>
                								<a class="redBack" href="javascript:void(0);" onclick="$(this).parent().parent().remove();">删</a>
                							</div>
                							<h6 data-id="item_input_{$j}" title="{$script.online_time|default=''}">{$script.title}</h6>
                							<input type="hidden" id="item_input_{$j}" value='{$script.item}' name="item[]"/>
										</div>
										
                            		<elseif condition="$script.type eq 1" />
										<div class="boo-item">
											<div class="boo-item-ctrl js-ctrl">
												<a class="blueBack js_list_move_up" id="move_up_">上移</a> 
												<a class="blueBack js_list_move_down" id="move_down_">下移</a>
												<a class="redBack" onclick="$(this).parent().parent().remove();">删除</a>
												<div class="boo-online-time">{$script.online_time|default=''}</div>
											</div>
											<div><img style="width:600px;height:215px;" src="{$script.image}"/></div>
											<div class="clear" ></div>
											<div class="boo-movie-info">
												<h6>{$script.title}</h6>
												<div class="clear"></div>
												<div>{$script.sub_title}</div>
												<div class="boo-movie-tags"><span class="level1">标签1</span><span class="level1">标签2</span><span>标签3</span></div> 
											</div>
											<div class="clear" ></div>
											<div class="boo-movie-grapher">
												<img src="http://imgs4.graphmovie.com/appimage/bj_1.jpg" class="boo-movie-avatar" />
												<div class="boo-movie-grapher-name">作者XXX</div>
												<div class="boo-movie-comment">xxx</div>
												<div class="boo-movie-like">xxx</div>
												<div class="boo-movie-play">xxxx万</div>
											</div>
											<input type="hidden" value='{$script.item}' name="item[]"/>
										</div>
									
									<elseif condition="$script.type eq 2" />
										<div class="boo-item">
											<div class="boo-item-ctrl boo-ctrl-wei js-ctrl" >
												<a class="blueBack js_list_move_up" id="move_up_{$script.index}">上移</a> 
												<a class="blueBack js_list_move_down" id="move_down_{$script.index}">下移</a> 
												<a class="redBack" onclick="$(this).parent().parent().remove();">删除</a> 
												<div class="boo-online-time">{$script.online_time|default=''}</div>
											</div>
											<div class="boo-wei">
												<div class="boo-wei-image"  style="background-image:url('{$script.image}')"></div>
											</div>
											<div class="boo-wei-info">
												<div class="boo-wei-title boo-nowrap">{$script.title}</div>
												<div class="boo-wei-subt boo-nowrap">{$script.sub_title}</div>
												<div class="boo-wei-other boo-nowrap">4小时前 / from 电影空间</div>
												<div class="clear"></div>
												<div class="boo-wei-grapher">
													<img src="http://imgs4.graphmovie.com/appimage/bj_1.jpg" class="boo-wei-avatar" />
													<div class="boo-wei-grapher-name">作者XXX</div>
													<div class="boo-wei-play">xx.x万</div>
												</div>
											</div>
											<div class="clear"></div>
											<input type="hidden" value='{$script.item}' name="item[]"/>
										</div>
									
									<elseif condition="$script.type eq 3" />
										<if condition="$script.show_type eq 1">
											<div class="boo-item">
												<div class="boo-item-ctrl boo-ctrl-paper js-ctrl"  style="z-index:20;">
													<a class="blueBack js_list_move_up" id="move_up_{$script.index}">上移</a> 
													<a class="blueBack js_list_move_down" id="move_down_{$script.index}">下移</a> 
													<a class="redBack" onclick="$(this).parent().parent().remove();">删除</a> 
													<div class="boo-online-time">{$script.online_time|default=''}</div>
												</div>
												<div class="boo-paper-1" style="background-image:url('{$script.image}')" >
													<div class="boo-paper-info">
													<div class="boo-paper-title">{$script.title}</div>
													<div class="boo-paper-subt">{$script.sub_title}</div>
												</div>
												</div>
												<input type="hidden" value='{$script.item}' name="item[]"/>
					 						</div>
					 					<elseif condition="$script.show_type eq 2" />
					 						<div class="boo-item">
												<div class="boo-item-ctrl boo-ctrl-wei js-ctrl" >
													<a class="blueBack js_list_move_up" id="move_up_{$script.index}">上移</a> 
													<a class="blueBack js_list_move_down" id="move_down_{$script.index}">下移</a> 
													<a class="redBack" onclick="$(this).parent().parent().remove();">删除</a>
													<div class="boo-online-time">{$script.online_time|default=''}</div>
												</div>
												<div class="boo-paper-2">
													<div class="boo-paper-image" style="background-image:url('{$script.image}')" ></div>
													<div class="boo-paper-info">
														<div class="boo-paper-title boo-nowrap">{$script.title}</div>
														<div class="boo-paper-by boo-nowrap"><span style="color:aaaaae;">By</span> 作者XXX</div>
														<div class="boo-paper-subt boo-nowrap">{$script.sub_title}</div>
														<div class="boo-paper-play">xx.x万</div>
														<div class="boo-paper-like">xxxx</div>
														<div class="boo-paper-tag">投稿栏目</div>
													</div>
												</div>
												<div class="clear"></div>
												<input type="hidden" value='{$script.item}' name="item[]"/>
										 	</div>
										</if>
									
									<elseif condition="$script.type eq 4" />
											<div class="boo-item">
												<div class="boo-item-ctrl boo-ctrl-image js-ctrl" >
													<a class="blueBack js_list_move_up" id="move_up_{$script.index}">上移</a> 
													<a class="blueBack js_list_move_down" id="move_down_{$script.index}">下移</a> 
													<a class="redBack" onclick="$(this).parent().parent().remove();">删除</a>
													<div class="boo-online-time">{$script.online_time|default=''}</div>
												</div>
												<div >
													<img src="{$script.image}" class="boo-tui" />
												</div>
												<div class="clear"></div>
												<php>unset($script['image']);</php>
												<input type="hidden" value='{$script.item}' name="item[]"/>
											</div>
									
									
									<elseif condition="$script.type eq 5" />
											<div class="boo-item">
												<div class="boo-item-ctrl boo-ctrl-adv js-ctrl" >
													<a class="blueBack js_list_move_up" id="move_up_{$script.index}">上移</a> 
													<a class="blueBack js_list_move_down" id="move_down_{$script.index}">下移</a> 
													<a class="redBack" onclick="$(this).parent().parent().remove();">删除</a>
													<div class="boo-online-time">{$script.online_time|default=''}</div> 
												</div>
												<div ><img style="width:600px;height:215px;" src="{$script.image}" /></div>
												<div class="boo-topic-info">
													<h6>{$script.title}</h6>
													<div class="clear"></div>
													<div class="boo-topic-subt">-- {$script.sub_title}</div>
													<div class="boo-topic-editernote">{$script.editor_note}</div>
												</div>
												<div class="clear"></div>
												<input type="hidden" value='{$script.item}' name="item[]"/>
											</div>
									
									<elseif condition="$script.type eq 6" />
            							<div class="boo-item">
            								<div style="position:absolute;right:20px;top:20px;z-index:120;" class="js-ctrl">
			            						<a class="greenBack js_list_move_up" id="move_up_{$i}">上</a> 
			            						<a class="greenBack js_list_move_down" id="move_down_{$i}">下</a> 
			            						<a class="redBack" href="javascript:void(0);" onclick="$(this).parent().parent().remove();">删</a>
			            						<div class="boo-online-time" style="bottom:-400px;left:-400px;">{$script.online_time|default=''}</div>
			            						<div class="clear"></div>
			            					</div>
	    									<div class="boo-image" style="background-image:url('{$script.image}')">
	    										<div class="boo-image-info">
	    											<div class="boo-image-title">{$script.title}</div>
	    											<div class="boo-image-subt">{$script.content}</div>
	    											<div class="boo-image-grapher">—— {$script.grapher}</div>
	    										</div>
	    										<div class="clear"></div>
	    									</div>
	    									<div class="clear"></div>
	    									<input type="hidden" value='{$script.item}' name="item[]"/>
	    								</div>
									</if>
                            	</volist>
                            	</div>
                            </div>
                            <div class="clear"></div>
                        </div>
                        <div class="formRow">
                            <div class="grid2"><label>预计上线时间：<span class="req">*</span> </label></div>
                            <div class="grid3"><input type="text" name="plan_time" id="play_time" value="{$vo.plan_time}" onFocus="WdatePicker({dateFmt:'yyyy-MM-dd HH:mm:00'})" placeholder="预计上线时间"/></div>
                            <div class="clear"></div>
                        </div>
                        <div class="formRow">
                            <div class="grid2"><label>备注：<span class="req">*</span> </label></div>
                            <div class="grid10"><textarea name="remark" rows="5">{$vo.remark}</textarea></div>
                            <div class="clear"></div>
                        </div>
                        <div class="formRow">
                        	<input type="hidden" value="{$vo.id}" name="id"/>
                        	<input type="submit" value="提 交" id="submit_form" class="buttonM bBlack formSubmit" />
                        	<div class="clear"></div>
                        </div>
                        <div class="clear"></div>
                    </div>
                    </form>
            </div>
    </div>
    <!-- Main content ends -->
    
</div>

<include file="HomeOnline:homePage2" />

<script>
(function(){
	/**
	* 提交表单数据
	*/
	var loading = false;
	$('#submit_form').click(function(){
		if (loading == true) {art.dialog('正在提交，请稍后。。。'); return;}
		var plan_time = $('#play_time').val();
		if (plan_time == '' || plan_time=="0000-00-00 00:00:00") {
			art.dialog('请填入预计上线时间'); return;
		}
		loading = true;
		$.ajax({
			url : "{:U('HomeOnline/doEditScript')}",
			data : $('#post_form').serialize(),
			type : 'POST',
			success : function(ret){
				if (typeof ret == 'object') {
					if (ret.rst == 0) {
						alert(ret.msg);
					} else if (ret.rst == 1) {
						alert('修改成功');
						document.location.href = "{:getCurrentUrl()}";
					}
				} else {
					alert('发生错误了，请截图！！！！！！！'+ret);
				}
				loading=false;
			},
			error : function(ex){
				loading=false;
				alert('ajax错误，有可能是网络原因导致的。');
			}
		});
	});
	
})();

</script>

<!-- Content ends -->
<include file="Public:footer" />
